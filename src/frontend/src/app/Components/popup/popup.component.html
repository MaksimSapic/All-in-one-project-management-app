<div class="container1">
  <div class="col-md-5 mx-2" id="popUp" *ngIf="task" #containerDiv>
    <div class="cardHead">
      <h6 *ngIf="this.task.projectRole=='3' || this.task.projectRole=='4'"  class="popupTaskName">{{ task.taskName }}</h6>
      <input  class="taskName" type="text" value="{{task.taskName}}" [(ngModel)]="task.taskName" (blur)="updateTaskName(task)" *ngIf="task.projectRole=='0' || task.projectRole=='1' || this.task.projectRole=='2'" [ngClass]="{'is-invalid': task.taskName.length<1 || task.taskName.length>100}">
      <div class="cardHeadSvg">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="full" viewBox="0 0 16 16" (click)="full()">
          <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707m0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707m-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707"/>
        </svg>
        <svg (click)="full()" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="exit_full" viewBox="0 0 16 16">
          <path d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5m5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5M0 10.5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 6 11.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5m10 1a1.5 1.5 0 0 1 1.5-1.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0z"/>
        </svg>
        <svg  *ngIf="!(this.task.statusName=='Completed' || this.task.statusName=='InReview' || this.task.statusName=='Archived') &&  this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'" (click)="openDeleteModal(ConfimDelete)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="trash" viewBox="0 0 16 16">
          <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
          <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="back" viewBox="0 0 16 16" (click)="close()">
          <path fill-rule="evenodd" d="M6 8a.5.5 0 0 0 .5.5h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L12.293 7.5H6.5A.5.5 0 0 0 6 8m-2.5 7a.5.5 0 0 1-.5-.5v-13a.5.5 0 0 1 1 0v13a.5.5 0 0 1-.5.5"/>
        </svg>
      </div>
    </div>
    <div class="scroll" [ngClass]="{ 'hide_comment': hide_comment_area(),'show_comment': !hide_comment_area() }" #commentDiv>
      <ng-template class="modal" #ConfimDelete>
        <div (click)="$event.stopPropagation();" class="modal-container" style="color: #697a8d; font-size: 16px;">
          <div class="modal-header">
            <h4 class="modal-title pull-left">Delete Task</h4>
            <svg (click)="modalRef?.hide()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
              <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
            </svg>
          </div>
          <div class="modal-body archBody">
            <span class="archSpan">Are you sure you want to delete this task? This action is irreversible.</span>
          </div>
          <div class="modal-footer archFooter">
            <button class="btn btn-primary d-grid w-100 mx-auto" (click)="$event.stopPropagation(); this.deleteTask(this.task.id); this.closeDeleteModal();">Delete Task</button>
          </div>
        </div>
      </ng-template>
      <div class="guestDueDate" *ngIf="this.task.projectRole=='3' || this.task.projectRole=='4'">
        <div class="gDDname">Due Date:</div><div class="guestDdate">{{ task.endDate | date }}</div>
      </div>
      
      <div class="taskDueDate" *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'">
        <div class="mInfoTitle">
          Due Date:
        </div>
        <div class="tNgDatePicker">
          <p-calendar
          *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'"
          [style]="{'width':'100%'}"
          [(ngModel)]="task.endDate"
          inputId="endDate"
          name="endDate"
          [showButtonBar]="true"
          [firstDayOfWeek]="1"
          placeholder="{{task.endDate|date}}"
          dateFormat="MM dd, yy"
          [minDate]="tTaskDueMin"
          [maxDate]="projectEndDate"
          (onSelect)="updateTaskDueDate()"
          (click)="$event.stopPropagation()"
          ></p-calendar>
        </div>
        <div pTooltip="Please select a new end date that is later than the current one." class="dueDateTooltip">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
          </svg>
        </div>
      </div>
      <div class="mOrigin">
        <div class="mInfoTitle">Origin Project:</div>
        <div id="popupOriginProject" (click)="goToProject(this.selectedProject)"><span class="badge bg-secondary">{{ this.selectedProject.projectName }}</span></div>
      </div>
      <div class="guestAssignee" *ngIf="this.task.projectRole=='3' || this.task.projectRole=='4'" >
        <div class="mInfoTitle">
          <label for="assignee">Assignee:</label>
        </div>
        <div *ngIf="!user?.firstName" class="guestAssigneeView">
          <div class="nnAvatar">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
              <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
            </svg>
          </div>
          <div>
            <span class="assigneeNameGuest">Not Assigned</span>
          </div>
        </div>
        <div *ngIf="user?.firstName" class="guestAssigneeView">
          <div class="ngxGuestView"><ngx-avatars id="assignee" *ngIf="!user?.profilePicUrl" size="30" bgColor="#5d57c2" [name]="user?.firstName+ ' ' + user?.lastName" class="avatar rounded-circle shadow-4-strong tNgxGuestView" height="25" width="25"></ngx-avatars></div>
          <div class="guestAssigneeImage"><img id="assignee" *ngIf="user?.profilePicUrl" [src]="this.uploadservice.getImage(user.profilePicUrl)" class="avatar rounded-circle" height="25" width="25"></div>
          <span class="assigneeNameGuest">{{user?.firstName}} {{user?.lastName}}</span>
        </div>
      </div>
      <div  class="mb-1 chooseAssignee" autocomplete="off" *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'">
        <div class="mInfoTitle">
          <label for="assignee" class="form-label">Assignee:</label>
        </div>
        <ng-select class="asigneeDropdown" [items]="users" [(ngModel)]="selectedUser" [clearable]="false" name="assignee" bindLabel="fullName" placeholder="Select Assignee" (click)="$event.stopPropagation()" (change)="updateTaskAppUserId(this.task)">
          <ng-template ng-option-tmp let-user="item" let-index="index">
            <div style="display: flex; align-items: center;">
              <div *ngIf="user.profilePicUrl" class="nameAvatar">
                <img [src]="uploadservice.getImage(user.profilePicUrl)" class="avatar rounded-circle shadow-4-strong" height="25" width="25"/>
              </div>
              <div *ngIf="!user.profilePicUrl" class="nameAvatar">
                <ngx-avatars size="25" bgColor="#5d57c2" [name]="user?.firstName + ' ' + user?.lastName" value="75%"></ngx-avatars>
              </div>
              <div>
                {{ user.fullName }}
              </div>
            </div>
          </ng-template>
          <ng-template ng-label-tmp let-item="item">
            <div style="display: flex; align-items: center;">
              <div *ngIf="item.profilePicUrl" class="nameAvatar">
                <img [src]="uploadservice.getImage(item.profilePicUrl)" class="avatar rounded-circle shadow-4-strong" height="25" width="25"/>
              </div>
              <div *ngIf="!item.profilePicUrl" class="nameAvatar">
                <ngx-avatars class="ngAvtr" size="25" bgColor="#5d57c2" [name]="item?.firstName + ' ' + item?.lastName" value="75%"></ngx-avatars>
              </div>
              <div>
                {{ item.fullName }}
              </div>
            </div>
          </ng-template>
        </ng-select>
      </div>
      <p style=" font-size: 16px; margin-bottom: 5px; margin-top:10px;">Description</p>
      <textarea class="description1 tNoBoxShadow" [class.no-hover]="task.projectRole=='3' || task.projectRole=='4'" rows="3" placeholder="Description" [value]="task.description" readonly *ngIf="task.projectRole=='3' || task.projectRole=='4'"></textarea>
      <textarea class="description tNoBoxShadow" rows="3" placeholder="Description" [value]="task.description" [(ngModel)]="task.description" (blur)="updateTaskDescription(this.task)" *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'"></textarea>
      <p style=" font-size: 16px; margin-bottom: 5px; margin-top:10px;">Dependency</p>
      <ng-select class="task_select" [ngClass]="{'guestDependencyView': this.task.projectRole=='3' || this.task.projectRole=='4'}" [disabled]="this.task.projectRole=='4' || this.task.projectRole=='3'" [placeholder]="this.task.projectRole=='4'?'No Dependencies':'Select Project Tasks'"  [items]="this.tasks"  [(ngModel)]="selectedTasks" bindLabel="name" bindValue="id" style="border-radius: 8px; font-size: 16 ; font-weight: 100;  color: #697a8d; " name="Dependency" [multiple]="true" (click)="$event.stopPropagation()" (blur)="this.addTaskDependency()">
        <ng-template ng-option-tmp let-task="item">
          <div class="user-detail" >
            <div class="nameAvatar">
              <div style="margin-left: 0.4rem;">{{ task.taskName }}</div>
            </div>
          </div>
        </ng-template>
        <ng-template ng-label-tmp let-item="item" let-clear="clear">
          <span class="ng-value-label">{{ item.taskName }}</span>
          <div *ngIf="this.task.projectRole!='3' && this.task.projectRole!='4'" class="ng-value-icon right" (click)="deleteTaskDependency(item); clear(item);"  aria-hidden="true">×</div>
        </ng-template>
      </ng-select>

      <p style="font-size: 16px; margin-bottom: 5px; margin-top:10px;">Section</p>
      <ng-select  [ngClass]="{'guestDependencyView': this.task.projectRole=='3' || this.task.projectRole=='4'}"  class="task_select task_selectDep" style="margin-bottom: 10px; border-radius: 8px; font-size: 16 ; font-weight: 100;  color: #697a8d;" [items]="sections" [(ngModel)]="selectedSection" name="assignee" bindLabel="fullName" [placeholder]="this.task.projectRole=='4'?'No Section':'Select Project Section'" (click)="$event.stopPropagation()" (change)="updateTaskSectionId(this.task)"
      [disabled]="this.task.projectRole=='4' || this.task.projectRole=='3'" >
        <ng-template ng-option-tmp let-section="item" let-index="index">
          <div style="display: flex; align-items: center;">
            <div>
              {{ section.sectionName }}
            </div>
        </div>
        </ng-template>
        <ng-template ng-label-tmp let-item="item">
          <div style="display: flex; align-items: center;">
            <div>
              {{ item.sectionName }}
            </div>
          </div>
        </ng-template>
      </ng-select>

    <div style="display: flex; align-items: center; justify-content: space-between; height: 30px;">
      <div  style="display: flex; align-items: center;">
        <label  *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'" style="margin-right: 5px; font-size: 16px;">Archive</label>
        <input  *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1' || this.task.projectRole=='2'" type="checkbox" class="tPCheck"
        [checked]="task.statusName=='Archived'"
        (change)="ArchiveTasks(task)">
      </div>
      <div class="markButtons">
        <button
          *ngIf="this.task.projectRole!='4'"
          class="mark" 
          [ngStyle]="{ 'pointer-events': this.DisableCloseTask()==false ? 'none' : 'auto', 'opacity': this.DisableCloseTask()==false ? 0.5 : 1 }"
          [ngClass]="{ 'closed': task && task.statusName === 'InReview',
          'cant_close': task && task.statusName == 'Completed' || task && this.task.statusName=='Archived'}"
          (click)="closeTask(task)"
        >
          {{ task && (task.statusName === 'InReview' || task.statusName=='Completed') ? "Re-open issue" : "Mark as done" }}
        </button>
        <button
          *ngIf="this.task.projectRole=='0' || this.task.projectRole=='1'"   
          class="mark"
          style="margin-right: 10px; "
          [ngClass]="{ 'completed': this.task && this.task.statusName == 'Completed',
            'not_closed': this.task && this.task.statusName != 'InReview',
            'not_completed': this.task && this.task.statusName == 'Completed'
         }"
          [ngStyle]="{ 'pointer-events': this.DisableCloseTask()==false ? 'none' : 'auto', 'opacity': this.DisableCloseTask()==false ? 0.5 : 1 }"
          (click)="toggleTaskCompletion(task)"
        >
          {{ task && task.statusName === 'Completed' ? "Remove from Completed" : "Mark Complete" }}
        </button>
      </div>
    </div>

    <div class="comments">
      <p class="header" id="comment_header">Comments</p>
      <div class="visible_comments">
        <span class="no_comments" *ngIf="!CheckForCommets(task)">No Comments</span>
        <div class="singleComment" *ngFor="let comment of comments">
          <ng-continer *ngIf="this.task.id===comment.taskId">
            <p style="margin-top: 5px;"> <ngx-avatars  id="assignee" *ngIf="!comment.appUserPicUrl" size="30" bgColor="#5d57c2" [name]="comment.senderFirstName + ' ' + comment.senderLastName" class="avatar rounded-circle shadow-4-strong" height="25" width="25"></ngx-avatars>
              <img *ngIf="comment.appUserPicUrl" id="assignee" [src]="this.uploadservice.getImage(comment.appUserPicUrl)"class="avatar rounded-circle shadow-4-strong" height="25" width="25"> {{ comment?.senderFirstName }} {{ comment?.senderLastName }}</p>
            <span class="comment_date">{{ comment?.messageSent  | date:'MMM d, y, h:mm a' }} <span *ngIf="comment.edited==true" >(edited)</span>
            <ng-continer *ngIf="this.task.projectRole!='4'">
              <svg *ngIf="this.comment.senderId==this.appUserId" (click)="ShowEdit(comment.id)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="edit" viewBox="0 0 16 16">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
              </svg>
            </ng-continer>
            </span>
            <div class="content">
                <p  id="comment_content{{comment.id}}" >{{ comment.content }}</p>
                <div class="m_edit">
                  <textarea class="edit_content" id="edit_content{{comment.id}}" style="display: none;" rows="3">{{ comment.content }}</textarea>
                  <button class="save_edit" id="save_edit{{comment.id}}" style="display: none;" (click)="editContent(comment.id)">Save Changes</button>
                  <button class="cancel_edit" id="cancel_edit{{comment.id}}" style="display: none;" (click)="CancelEdit(comment.id)">Cancel</button>
                  <label class="fileUrl" style="margin-left: 20px;" for="fileurl" (click)="downloadFile(comment?.fileUrl)" *ngIf="comment?.fileUrl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-arrow-down msvg-download" viewBox="0 0 16 16">
                      <path d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5"/>
                      <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
                    </svg>
                    <a class="download-link" >{{ this.abbreviate(comment?.fileUrl) }}</a>
                  </label>
                </div>
            </div>
          </ng-continer>
        </div>
      </div>
    </div>
    </div>
    <div *ngIf="this.task.projectRole!='4'" class="fixed-comment-area" #fixedArea>
      <textarea [disabled]="task.projectRole == '4'" class="comment tNoBoxShadow" rows="3" placeholder="Add a comment" #commentInput></textarea>
      <div style="display: flex; align-items: center; justify-content: space-between;">
          <span class="upload_attachment">
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              width="20" 
              height="25" 
              fill="currentColor" 
              class="bi bi-paperclip" 
              viewBox="0 0 16 16"
              class="file"
              style="float:left; margin-right: 10px;"
              (click)="fileInput.click()">
              <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0z"/>
            </svg>
            <span *ngIf="attachment_added">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-arrow-down" viewBox="0 0 16 16">
                <path d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5"/>
                <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
              </svg>{{this.abbreviate(attachment_name)}}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg m-SVG" viewBox="0 0 16 16" (click)="clearattachment($event)">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
              </svg>

            </span>
          </span>
          <input
            type="file"
            #fileInput
            style="display: none"
            (change)="fileInputHandler($event)"
          />
        <button *ngIf="this.task.projectRole!='4'" class="add_comment" (click)="addComment()">Add Comment</button>
      </div>
    </div>
  </div>
</div>